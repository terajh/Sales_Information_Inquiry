<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/Face_Mosaic_Dotcom/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><link rel="stylesheet" href="./style/dropzone.css"/><link rel="stylesheet" href="./style/slider.css"/><script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.js"></script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"><script type="text/javascript" src="./javascript/dropzone.js"></script><script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script><script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface"></script><title>Humozaic</title><link href="/Face_Mosaic_Dotcom/static/css/2.1a02f21c.chunk.css" rel="stylesheet"><link href="/Face_Mosaic_Dotcom/static/css/main.7327a5d9.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div><script>!function(e){function r(r){for(var n,a,i=r[0],c=r[1],l=r[2],f=0,s=[];f<i.length;f++)a=i[f],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&s.push(o[a][0]),o[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(p&&p(r);s.length;)s.shift()();return u.push.apply(u,l||[]),t()}function t(){for(var e,r=0;r<u.length;r++){for(var t=u[r],n=!0,i=1;i<t.length;i++){var c=t[i];0!==o[c]&&(n=!1)}n&&(u.splice(r--,1),e=a(a.s=t[0]))}return e}var n={},o={1:0},u=[];function a(r){if(n[r])return n[r].exports;var t=n[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.e=function(e){var r=[],t=o[e];if(0!==t)if(t)r.push(t[2]);else{var n=new Promise((function(r,n){t=o[e]=[r,n]}));r.push(t[2]=n);var u,i=document.createElement("script");i.charset="utf-8",i.timeout=120,a.nc&&i.setAttribute("nonce",a.nc),i.src=function(e){return a.p+"static/js/"+({}[e]||e)+"."+{3:"dad64b0c"}[e]+".chunk.js"}(e);var c=new Error;u=function(r){i.onerror=i.onload=null,clearTimeout(l);var t=o[e];if(0!==t){if(t){var n=r&&("load"===r.type?"missing":r.type),u=r&&r.target&&r.target.src;c.message="Loading chunk "+e+" failed.\n("+n+": "+u+")",c.name="ChunkLoadError",c.type=n,c.request=u,t[1](c)}o[e]=void 0}};var l=setTimeout((function(){u({type:"timeout",target:i})}),12e4);i.onerror=i.onload=u,document.head.appendChild(i)}return Promise.all(r)},a.m=e,a.c=n,a.d=function(e,r,t){a.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,r){if(1&r&&(e=a(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var n in e)a.d(t,n,function(r){return e[r]}.bind(null,n));return t},a.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(r,"a",r),r},a.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},a.p="/Face_Mosaic_Dotcom/",a.oe=function(e){throw console.error(e),e};var i=this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[],c=i.push.bind(i);i.push=r,i=i.slice();for(var l=0;l<i.length;l++)r(i[l]);var p=c;t()}([])</script><script src="/Face_Mosaic_Dotcom/static/js/2.1e8c772f.chunk.js"></script><script src="/Face_Mosaic_Dotcom/static/js/main.8899eb4f.chunk.js"></script></body><script>var _pos_x,_pos_y,ratio,TILE_HEIGHT=10,TILE_WIDTH=10,current_image_id=null,slider_value=[1,2,3,5,6,9,10,15,18,27];$(window).load(()=>{const t=document.querySelector("#jsCanvas"),e=t.getContext("2d"),a=(document.querySelector(".browse-btn"),document.querySelector("#real-input"));document.querySelector("#down_images").addEventListener("click",()=>{var t=document.querySelector("#jsCanvas").toDataURL("image/png");t=(t=t.replace(/^data:image\/[^;]*/,"data:application/octet-stream")).replace(/^data:application\/octet-stream/,"data:application/octet-stream;headers=Content-Disposition%3A%20attachment%3B%20filename=Canvas.png");var e=document.createElement("a");e.download="mozaic.png",e.href=t,e.click()}),a.addEventListener("change",(async function(a){var r=a.target.files,i=new FileReader;i.onload=function(a){var r=new Image;r.onload=async function(){r,console.log(r.width,r.height),ratio=1050/r.width,t_ratio=730/r.height,ratio=ratio<t_ratio?ratio:t_ratio,t.width=r.width*ratio,t.height=r.height*ratio,e.drawImage(r,0,0,t.width,t.height);new FormData;$("body").toggleClass("loading");const a=await blazeface.load(),i=await a.estimateFaces(r,!1);var o=[],n=[];if(i.length>0){console.log(i);for(let t=0;t<i.length;t++)o.push(i[t].topLeft[0]),n.push(i[t].topLeft[1]),o.push(i[t].bottomRight[0]),n.push(i[t].bottomRight[1])}$("body").toggleClass("loading"),console.log(o,n),_pos_x=o,_pos_y=n;for(var d=$("#select_mozaic_human"),c=0;c<o.length;c+=2){var g=document.createElement("div");g.className="face_div";var s=document.createElement("input");s.className="check_face display_none",s.id="radio"+c.toString(),s.type="radio";var l=document.createElement("canvas");l.className="face_canvas",l.id="canvas"+c.toString(),l.setAttribute("x",o[c]),l.setAttribute("y",n[c]),l.setAttribute("dx",o[c+1]-o[c]),l.setAttribute("dy",n[c+1]-n[c]),l.getContext("2d").drawImage(r,o[c],n[c],o[c+1]-o[c],n[c+1]-n[c],0,0,l.width,l.height),g.append(s),g.append(l),d.append(g),l.addEventListener("click",t=>{var a=new Image;if(console.log("click"),"true"!==$("#radio"+t.target.id.split("canvas")[1]).attr("check")){$("#"+t.target.id).toggleClass("face_canvas_select"),$("#radio"+t.target.id.split("canvas")[1]).prop("checked",!0),$("#radio"+t.target.id.split("canvas")[1]).attr("check",!0);var r=document.querySelector("#"+t.target.id).toDataURL("image/ipeg");current_image_id=t.target.id;var i=document.querySelector("#"+t.target.id).getContext("2d"),o=document.querySelector("#previewCanvas");o.getContext("2d").drawImage(i.canvas,0,0,o.width,o.height),a.onload=function(t){var e=document.querySelector("#"+current_image_id),a=e.getAttribute("x"),r=e.getAttribute("y"),i=e.getAttribute("dx"),o=e.getAttribute("dy");photomosaic(t.path[0],a*ratio,r*ratio,i*ratio,o*ratio)},a.src=r}else{$("#"+t.target.id).toggleClass("face_canvas_select"),$("#radio"+t.target.id.split("canvas")[1]).prop("checked",!1),$("#radio"+t.target.id.split("canvas")[1]).attr("check",!1);let a=document.querySelector("#"+t.target.id),r=a.getContext("2d");var n=a.getAttribute("x")*ratio,d=a.getAttribute("y")*ratio,c=a.getAttribute("dx")*ratio,g=a.getAttribute("dy")*ratio;e.drawImage(r.canvas,0,0,r.canvas.width,r.canvas.height,n,d,c,g)}})}},r.src=a.target.result},i.readAsDataURL(r[0])}))});var slider=document.getElementById("myRange"),output=document.getElementById("demo");function photomosaic(t,e=-1,a=-1,r=-1,i=-1){var o=TILE_WIDTH,n=TILE_HEIGHT,d=document.querySelector("#previewCanvas"),c=d.getContext("2d"),g=c.getImageData(0,0,d.width,d.height),s=g.data,l=d.width/o,u=d.height/n;function m(t,e){var a,r,i=-4,o={r:0,g:0,b:0},n=0;try{a=c.getImageData(e*TILE_WIDTH,t*TILE_HEIGHT,TILE_HEIGHT,TILE_WIDTH)}catch(t){return alert("Not happening this time!"),o}for(r=a.data.length;(i+=4)<r;)++n,o.r+=a.data[i],o.g+=a.data[i+1],o.b+=a.data[i+2];return o.r=~~(o.r/n),o.g=~~(o.g/n),o.b=~~(o.b/n),o}for(var h=0;h<u;h++)for(var v=0;v<l;v++)for(var p=m(h,v),_=p.r,y=p.g,w=p.b,I=0;I<n;I++)for(var f=0;f<o;f++){var b=v*o+f,E=(h*n+I)*(4*g.width)+4*b;s[E+0]=_,s[E+1]=y,s[E+2]=w,s[E+3]=255}if(c.putImageData(g,0,0),-1!=e){document.querySelector("#jsCanvas").getContext("2d").drawImage(c.canvas,0,0,c.canvas.width,c.canvas.height,e,a,r,i)}return d}$("#myRange").attr("value","50"),slider.max=10,slider.value=5,(slider=document.getElementById("myRange")).oninput=function(){var t=new Image,e=document.querySelector("#"+current_image_id).toDataURL("image/ipeg"),a=document.querySelector("#"+current_image_id).getContext("2d"),r=document.querySelector("#previewCanvas"),i=r.getContext("2d");i.clearRect(0,0,r.width,r.height),i.drawImage(a.canvas,0,0,r.width,r.height),TILE_HEIGHT=slider_value[slider.value-1],TILE_WIDTH=slider_value[slider.value-1],t.onload=function(){var e=document.querySelector("#"+current_image_id),a=e.getAttribute("x"),r=e.getAttribute("y"),i=e.getAttribute("dx"),o=e.getAttribute("dy");photomosaic(t,a*ratio,r*ratio,i*ratio,o*ratio)},t.src=e}</script></html>